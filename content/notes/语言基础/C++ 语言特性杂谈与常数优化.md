---
title: C++ 语言特性杂谈与常数优化
date: 2023-02-02 21:06:12
tags: 
- [语言]
- [常数优化]
- [语言特性]
categories: 语言
description: 仅仅作为参考，不保证完全正确，未完
image: https://pic.imgdb.cn/item/6416687ca682492fccfb973a.jpg
---

起因是发现很多同学对常数优化和语句的执行效率有误解（我肯定也有，但是我尽量把我知道的正确的写出来），因此写一篇杂谈做一个说明，同时介绍一些比较新的好用的语言特性（C++14）

## `template` 模板函数

### 基本

`template` 顾名思义是用来做模板的，那是做什么的模板呢？
举个例子，一般来说我们写 `max` 函数替代 `std::max` 来优化的时候，写出来的大概长下面这样：
```C++
int max(int a, int b) {
    return a > b ? a : b;
}
```
在这三行代码中，第一行定义了 `max` 的返回值和参数 `a` `b` 的类型为 `int`，显然意味着这个函数只能比较 `int` 类型的量。

那么如果既想要比较 `int` 又想要比较 `long long` 还想比较 `char` 等等，如果按传统的写法，就是 Ctrl+C Ctrl+V 写好几个比较函数，还得重新命名，甚是麻烦。

观察写出来的几个函数，肉眼可见他们的本质区别只有返回值与参数的类型。那么有没有一种类似模板的东西，写一个函数的主要部分作为模板，返回值、变量的类型由编译器决定呢？

这就是 `template` 的一大作用，也是 OI 中最常用的方面。

使用起来也很简单，在函数声明前面加上 `template <typename T>`，此处 T 可以是随便一个字母或者单词，后面写函数的时候把 `int` 替换成 `T` 即可。
```C++
template <typename T>
T max(T a, T b) {
    return a > b ? a : b;
} 
```
此时的 `T` 相当于一个变量类型，如果这个函数被调用，编译器会给你生成一个符合传入参数的类型的 `max` 函数。

### TODO: `...` 关键字

## 基于范围的循环

不过多介绍了，主要在 STL 里用

```c++
for (auto i : container) {
    std::cout << i << ' ';
}
```

`container` 为容器的名称，`auto` 是 C++11 以后的类型名称，编译时由编译器推断。

此处 `auto` 的效果就是把 `i` 的类型设置为 `container` 的元素的类型。如果 `container` 是 `vector<int>` ，则上面语句的效果就是遍历 `container` 的所有元素并输出。

此外，如果想遍历的同时修改容器中的元素，可以在 `i` 前加取址符 `&` 表示引用，如下

```c++
for (auto &i : container) {
    i = 0;
}
```

该段代码的效果即为遍历容器 `container`，同时把其中所有元素赋值为 `0`;